{% extends "layout.html" %}


{% block special_static %}
    {% load static %}
{% endblock special_static %}

{% block content %}
<div class="row name">
    <div class="col-md-2">
        <div class="feed-bar">
            <label>Feeds</label>
            <ul>
                <li class="feed-item topquestions ">
                    سوال‌ها برای شما
                </li>
                <li class="feed-item topanswers">
                    پاسخ‌ها برای شما
                </li>

                <li class="feed-item requests">
                    درخواست‌های پاسخ
                </li>
                <li class="feed-item bookmarks">
                    پاسخ‌های bookmark شده
                </li>
                <li class="feed-item addtopics">
                    موضوع‌ها
                </li>
            </ul>
        </div>

    </div>
    <div class="feeds col-md-8">

    </div>
    <div class="col-md-2">
        <label>left bar</label>
    </div>
</div>

<script>
$(function() {
    window.onload = function() {
      $('.feed-bar .feed-item.topquestions').trigger('click');
    };

    var $feeds = $(".feeds");

    $feeds.on('click', '.search-topic img', function (e) {
        var name = $(this).siblings('textarea')[0].value;
        $.get("/search-topic/", {'name':name, 'way':'full'}, function (data) {
            $('.feeds .searched-topics').html(data);
        });
            e.stopPropagation();
    });

    $feeds.on('click', '.topic-list .topic-item .action-item', function (e) {
        var $topicObj = $(this).parents('.topic-item');
        var topicID = $topicObj[0].id.split('-')[1];
        if ($(this).hasClass('follow')){
            $.get("/follow_topic/" + topicID + "/", {'follow':'1'}, function (data) {
                var $topicItems = $feeds.find('.topic-list .topic-item#t-' + topicID );
                $topicItems.find('.follow.action-item').removeClass('show').addClass('hide');
                $topicItems.find('.unfollow.action-item').removeClass('hide').addClass('show').find('.follower-count').text(data.count);
            });
        }else {
            $.get("/follow_topic/" + topicID + "/", {'follow':'0'}, function (data) {
                var $topicItems = $feeds.find('.topic-list .topic-item#t-' + topicID );
                $topicItems.find('.follow.action-item').removeClass('hide').addClass('show').find('.follower-count').text(data.count);
                $topicItems.find('.unfollow.action-item').removeClass('show').addClass('hide');
            });
        }

            e.stopPropagation();
    });

    $('.feed-bar .feed-item').click(function(e) { // limit click to children of main menu
        var $feedObj = $(this);
        if(!$feedObj.hasClass('selected')){
            var feedName = $feedObj.attr('class').split(' ')[1];
            $('.feed-bar .feed-item').removeClass('selected');
            $feedObj.addClass('selected');
            {#$('.feeds > div').removeClass('show').addClass('hide');#}
            {#$('.feeds div.' + feedName).removeClass('hide').addClass('show');#}
            $.get("/profile_get_feed/" + {{ user.id }} + "/" + feedName + "/", {}, function (data) {
                $('.feeds').html(data);
            });
        }

        e.stopPropagation();
    });
    $(".more.id").click(function(e) { // limit click to children of main menu
        $(this).siblings(".full").removeClass('hide').addClass('show');
        $(this).siblings(".less.id").removeClass('hide').addClass('show');
        $(this).siblings(".text.truncated").removeClass('show').addClass('hide');
        $(this).removeClass('show').addClass('hide');


        e.stopPropagation();
    });
    $(".less.id").click(function(e) { // limit click to children of main menu
        console.log('hii');
        $(this).siblings(".more.id").removeClass('hide').addClass('show');
        $(this).siblings(".text.truncated").removeClass('hide').addClass('show');
        $(this).removeClass('show').addClass('hide');
        $(this).siblings(".full").removeClass('show').addClass('hide');
        e.stopPropagation();
    });
    $(".action-item.bookmark").click(function(e) { // limit click to children of main menu
        var text = $(this).find('div').text();
        if (text==="حذف از نشانه‌ها"){
            $(this).find('img').attr('src','{% static "/image/bookmark add.svg" %}');
            $(this).find('div').text("اضافه به نشانه‌ها");
        }else{
            $(this).find('img').attr('src','{% static "/image/bookmark remove.svg" %}');
            $(this).find('div').text("حذف از نشانه‌ها");
        }
        e.stopPropagation();
    });
});
var span = $('<span>').css('display','inline-block')
.css('word-break','break-all').appendTo('body').css('visibility','hidden');
function initSpan(textarea){
  span.text(textarea.text())
      .width(textarea.width())
      .css('font',textarea.css('font'));
}
$('textarea').on({
    input: function(){
      var text = $(this).val();
      span.text(text);
      $(this).height(text ? span.height() : '1.1em');
    },
    focus: function(){
     initSpan($(this));
    },
    keypress: function(e){
        if(e.which == 13) e.preventDefault();
    }
});
</script>





{% endblock content %}